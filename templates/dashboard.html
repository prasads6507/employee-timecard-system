{% extends 'base.html' %} {% block title %}Dashboard{% endblock %} {% block content %}
<h4 class="text-success">Welcome, {{ user.username }}</h4>

<div class="mb-3">
    {% if role == 'employee' %}
    <a href="/clock_in" class="btn btn-success">Clock In</a>
    <a href="/clock_out" class="btn btn-danger">Clock Out</a> {% endif %} {% if role == 'admin' %}
    <a href="/add_user" class="btn btn-primary">Add New User</a> {% endif %}
    <a href="/export_csv" class="btn btn-secondary">Export CSV</a>
    <a href="/export_pdf" class="btn btn-secondary">Export PDF</a>
    <a href="/logout" class="btn btn-outline-dark float-end">Logout</a>
</div>

<!-- Personal summary cards -->
<div class="row g-3">
    <div class="col-md-3">
        <div class="card shadow-sm p-3">
            <div class="fw-bold text-muted">Today</div>
            <div class="fs-4">{{ my_today }} min</div>
            <div class="small {{ 'text-danger' if my_today_ot > 0 else 'text-muted' }}">OT Today: {{ my_today_ot }} min</div>
            <div class="small {{ 'text-success' if my_clocked_in else 'text-muted' }}">Status: {{ 'Clocked In' if my_clocked_in else 'Clocked Out' }}</div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card shadow-sm p-3">
            <div class="fw-bold text-muted">This Week</div>
            <div class="fs-4">{{ my_week }} min</div>
            <div class="small {{ 'text-danger' if my_week_ot > 0 else 'text-muted' }}">OT Week: {{ my_week_ot }} min</div>
        </div>
    </div>
</div>

{% if summary %}
<h4 class="mt-4">Team Summary (Today & This Week)</h4>
<table class="table table-bordered align-middle">
    <thead>
        <tr>
            <th>Employee</th>
            <th>Status</th>
            <th>Today (min)</th>
            <th>OT Today</th>
            <th>Week (min)</th>
            <th>OT Week</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
        {% for username, data in summary.items() %}
        <tr>
            <td>{{ username }}</td>
            <td><span class="badge {{ 'bg-success' if data.clocked_in else 'bg-secondary' }}">{{ 'In' if data.clocked_in else 'Out' }}</span></td>
            <td>{{ data.today_minutes }}</td>
            <td class="{{ 'text-danger' if data.today_ot > 0 }}">{{ data.today_ot }}</td>
            <td>{{ data.week_minutes }}</td>
            <td class="{{ 'text-danger' if data.week_ot > 0 }}">{{ data.week_ot }}</td>
            <td>
                <form method="POST" action="/delete_user/{{ username }}" onsubmit="return confirm('Delete {{ username }}?')" style="display:inline;">
                    <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endif %}

<h4 class="mt-4">Time Logs</h4>
<table class="table table-bordered table-striped">
    <thead>
        <tr>
            <th>Clock In</th>
            <th>Clock Out</th>
        </tr>
    </thead>
    <tbody>
        {% for log in logs %}
        <tr>
            <td>{{ log.clock_in }}</td>
            <td>{{ log.clock_out or 'â€”' }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}